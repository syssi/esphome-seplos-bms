substitutions:
  name: pace-bms-tests
  tx_pin: GPIO4
  rx_pin: GPIO5

esphome:
  name: ${name}

esp8266:
  board: d1_mini

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

ota:

logger:
  level: DEBUG

api:
  reboot_timeout: 0s

uart:
  id: uart_0
  baud_rate: 9600
  tx_pin: ${tx_pin}
  rx_pin: ${rx_pin}
  debug:
    direction: BOTH
    dummy_receiver: false

modbus:
  - id: modbus0
    uart_id: uart_0
    send_wait_time: 200ms

modbus_controller:
  - id: bms0
    # Slave address 0x01
    address: 0x01
    modbus_id: modbus0
    command_throttle: 200ms
    update_interval: 10s

sensor:
  # 0x0000 Current                               2 byte   R   int16  10mA (Positive: chargingm Negative: discharging)
  # 0x0001 Voltage of pack                       2 byte   R  uint16  10mV
  - platform: modbus_controller
    modbus_controller_id: bms0
    name: "${name} total voltage"
    address: 0x0001
    register_type: holding
    value_type: U_WORD
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - multiply: 0.01

  # 0x0002 State of charge                       2 byte   R   uint8  % (0-100%)
  - platform: modbus_controller
    modbus_controller_id: bms0
    name: "${name} state of charge"
    address: 0x0002
    register_type: holding
    value_type: U_WORD
    unit_of_measurement: "%"
    device_class: battery
    state_class: measurement
    accuracy_decimals: 0

  # 0x0003 SOH                                   2 byte   R   uint8  % (0-100%)
  - platform: modbus_controller
    modbus_controller_id: bms0
    name: "${name} state of health"
    address: 0x0003
    register_type: holding
    value_type: U_WORD
    unit_of_measurement: "%"
    # device_class: battery
    state_class: measurement
    accuracy_decimals: 0

  # 0x0004 Remain capacity                       2 byte   R  uint16  10mAH
  # 0x0005 Full capacity                         2 byte   R  uint16  10mAH
  # 0x0006 Design capacity                       2 byte   R  uint16  10mAH
  # 0x0007 Battery cycle counts                  2 byte   R  uint16  Cyc.
  # 0x0009 Warning flag                          2 byte   R  uint16  Hex See ^1
  # 0x0010 Protection flag                       2 byte   R  uint16  Hex See ^2
  # 0x0011 Status/Fault flag                     2 byte   R  uint16  Hex See ^3
  # 0x0012 Balance status                        2 byte   R  uint16  Hex
  # 0x0015-0030 Cell voltage                    32 byte   R  uint16  mV (Voltage of 16 cells, 2 byte for each cell)
  # 0x0031-0034 Cell temperature                 8 byte   R   int16  0.1 ℃ (4 cell temperature, 2 byte for each cell)
  # 0x0035 MOSFET temperature                    2 byte   R   int16  0.1 ℃ or invalid
  # 0x0036 Environment temperature               2 byte   R   int16  0.1 ℃ or invalid
  # 0x0060 Pack OV alarm                         2 byte  RW  uint16  mV
  # 0x0061 Pack OV protection                    2 byte  RW  uint16  mV
  # 0x0062 Pack OV release protection            2 byte  RW  uint16  mV
  # 0x0063 Pack OV protection delay time         2 byte  RW  uint8   0.1S 1~255
  # 0x0064 Cell OV alarm                         2 byte  RW  uint16  mV
  # 0x0065 Cell OV protection                    2 byte  RW  uint16  mV
  # 0x0066 Cell OV release protection            2 byte  RW  uint16  mV
  # 0x0067 Cell OV protection delay time         2 byte  RW   uint8  0.1S 1~255
  # 0x0068 Pack UV alarm                         2 byte  RW  uint16  mV
  # 0x0069 Pack UV protection                    2 byte  RW  uint16  mV
  # 0x0070 Pack UV release protection            2 byte  RW  uint16  mV
  # 0x0071 Pack UV protection delay time         2 byte  RW   uint8  0.1S 1~255
  # 0x0072 Cell UV alarm                         2 byte  RW  uint16  mV
  # 0x0073 Cell UV protection                    2 byte  RW  uint16  mV
  # 0x0074 Cell UV release protection            2 byte  RW  uint16  mV
  # 0x0075 Cell UV protection delay time         2 byte  RW   uint8  0.1S 1~255
  # 0x0076 Charging OC alarm                     2 byte  RW  uint16  A
  # 0x0077 Charging OC protection                2 byte  RW  uint16  A
  # 0x0078 Charging OC protection delay time     2 byte  RW   uint8  0.1S 1~255
  # 0x0079 Discharging OC alarm                  2 byte  RW  uint16  A
  # 0x0080 Discharging OC protection             2 byte  RW  uint16  A
  # 0x0081 Discharging OC protection delay time  2 byte  RW   uint8  0.1S 1~255
  # 0x0082 Discharging OC protection             2 byte  RW  uint16
  # 0x0083 Discharging OC protection delay time  2 byte  RW   uint8  0.025S 1~255
  # 0x0084 Charging OT alarm                     2 byte  RW   int16  0.1 ℃
  # 0x0085 Charging OT protection                2 byte  RW   int16  0.1 ℃
  # 0x0086 Charging OT release protection        2 byte  RW   int16  0.1 ℃
  # 0x0087 Discharging OT alarm                  2 byte  RW   int16  0.1 ℃
  # 0x0088 Discharging OT protection             2 byte  RW   int16  0.1 ℃
  # 0x0089 Discharging OT release                2 byte  RW   int16  0.1 ℃
  # 0x0090 Charging UT alarm                     2 byte  RW   int16  0.1 ℃
  # 0x0091 Charging UT protection                2 byte  RW   int16  0.1 ℃
  # 0x0092 Charging UT release protection        2 byte  RW   int16  0.1 ℃
  # 0x0093 Discharging UT alarm                  2 byte  RW   int16  0.1 ℃
  # 0x0094 Discharging UT protection             2 byte  RW   int16  0.1 ℃
  # 0x0095 Discharging UT release protection     2 byte  RW   int16  0.1 ℃
  # 0x0096 MOSFET OT alarm                       2 byte  RW   int16  0.1 ℃ Or invalid parameters in BMS-4820
  # 0x0097 MOSFET OT protection                  2 byte  RW   int16  0.1 ℃
  # 0x0098 MOSFET OT release protection          2 byte  RW   int16  0.1 ℃
  # 0x0099 Environment OT alarm                  2 byte  RW   int16  0.1 ℃
  # 0x0100 Environment OT protection             2 byte  RW   int16  0.1 ℃
  # 0x0101 Environment OT release protection     2 byte  RW   int16  0.1 ℃
  # 0x0102 Environment UT alarm                  2 byte  RW   int16  0.1 ℃
  # 0x0103 Environment UT protection             2 byte  RW   int16  0.1 ℃
  # 0x0104 Environment UT release protection     2 byte  RW   int16  0.1 ℃
  # 0x0105 Balance start cell voltage            2 byte  RW  uint16  mV
  # 0x0106 Balance start delta voltage           2 byte  RW  uint16  mV
  # 0x0107 Pack full-charge voltage              2 byte  RW  uint16  mV
  # 0x0108 Pack full-charge current              2 byte  RW  uint16  mA
  # 0x0109 Cell sleep voltage                    2 byte  RW  uint16  mV
  # 0x0110 Cell sleep delay time                 2 byte  RW  uint16  min
  # 0x0111 Short circuit protect delay time      2 byte  RW   uint8  25uS Max 500uS
  # 0x0112 SOC alarm threshold                   2 byte  RW   uint8  % 0~100%
  # 0x0113 Charging OC-2 protection              2 byte  RW  uint16  A
  # 0x0114 Charging OC-2 protection delay time   2 byte  RW   uint8  0.025S 1~255
  # 0x0150-0159 Version information             20 byte   R  uint16  ASCII
  # 0x0160-0169 Model SN                        20 byte  RW  uint16  ASCII BMS Manufacturer
  # 0x0170-0179 PACK SN                         20 byte  RW  uint16  ASCII PACK Manufacturer
